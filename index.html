<!DOCTYPE html>
<html lang="fr-FR"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.27">

  <meta name="author" content="Romain Avouac">
  <meta name="author" content="Lino Galiana">
  <title>Mise en production des projets de data science</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-a98430368b5d08d5d89ffd4526a3edd6.css">
  <link rel="stylesheet" href="site_libs/quarto-contrib/quarto-project/InseeFrLab/onyxia/logo.css">
  <link rel="stylesheet" href="custom.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Mise en production des projets de data science</h1>
  <p class="subtitle"></p><p><span class="blue2">Cours de 3e ann√©e √† l‚ÄôENSAE</span><br> 2025/2026</p><p></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Romain Avouac 
</div>
</div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Lino Galiana 
</div>
</div>
</div>

</section>
<section class="slide level2">

<!-- {{< include sections/introduction.qmd >}}

# Partie :one: : bonnes pratiques de d√©veloppement

## Plan de la partie

:one: [**Travail collaboratif**]{.blue2} avec `Git`

:two: [**Qualit√©**]{.blue2} du code

:three: [**Structure**]{.blue2} des projets

:four: Traitement des [**donn√©es volumineuses**]{.blue2}

:five: Favoriser la [**portabilit√©**]{.blue2} d'une application


# :one: Le travail collaboratif avec `Git`

## Pourquoi utiliser Git ?

![Source : [ThinkR](https://thinkr.fr/travailler-avec-git-via-rstudio-et-versionner-son-code/)](img/timeline.png){fig-align="center" height=475}

## Concepts essentiels

![Source : [fabacademy.org](http://fabacademy.org/2021/labs/bhubaneswar/students/deepak-chaudhry/ia_PPFP.html)](img/gitallinone.png){height="400" fig-align="center"}

## Bonnes pratiques {auto-animate=true .smaller}

__Que versionne-t-on ?__

- Essentiellement du [**code source**]{.orange}
- [__Pas d'outputs__]{.orange} (fichiers `.html`, `.pdf`, mod√®les...)
- [__Pas de donn√©es__]{.orange}, d'informations locales ou sensibles

. . .

:::{.callout-note}

Pour d√©finir des r√®gles qui √©vitent de committer tel ou tel fichier, on utilise
un fichier nomm√© __`.gitignore`__.

Si on m√©lange du code et des √©l√©ments
annexes (_output_, donn√©es...) dans un m√™me dossier, il [__faut consacrer du temps √† ce fichier__]{.orange}.

N'h√©sitez pas √† y ajouter des r√®gles conservatrices (par exemple `*.csv`, `*.parquet`).
:::

## Bonnes pratiques {auto-animate=true .smaller}

__Format des commits__

::: {layout="[40,60]"}

- [**Fr√©quence**]{.orange}
    - Aussi souvent que possible
    - Le lot de modifications doit "faire sens"
- [**Messages**]{.orange}
    - Courts et informatifs (comme un titre de mail)
    - D√©crire [**le pourquoi plut√¥t que le comment**]{.orange} dans le texte

![](img/titre-commit.png)

:::

## Outils pour le travail collaboratif

- L'√©co-syst√®me `Git` [**facilite** le travail collaboratif]{.blue2}
    - `Git`  : mod√®le des [__branches__]{.orange}
    - `GitHub`  / `GitLab`  : [**Issues**, **Pull Requests**, **Forks**]{.orange}

## Le mod√®le des branches

::: {layout="[[-1], [1], [-1]]"}
![Source : [lutece.paris.fr](https://lutece.paris.fr/support/jsp/site/Portal.jsp?page=wiki&view=page&page_name=git&language=fr)](img/branches.png){fig-align="center" height=350}
:::

## Les outils de contribution

- [***Issue***]{.orange} : soumettre un [**probl√®me**]{.blue2} ou une [**suggestion**]{.blue2} aux d√©veloppeurs d'un projet

- [***Pull Request***]{.orange} : proposer aux d√©veloppeurs d'un projet d'[**int√©grer des modifications**]{.blue2}

- [***Fork***]{.orange} : faire la [**copie**]{.blue2} d'un projet existant dans son espace personnel
    - Indispensable pour faire une *pull request* √† un d√©p√¥t sur lequel on n'a pas les droits

## Une organisation courante : le *GitHub flow*

![](img/ghflow.png)

Description plus d√©taill√©e : [ici](https://docs.github.com/en/get-started/quickstart/github-flow)


# :two: Qualit√© du code

## Enjeux

- D'une vision utilitariste du code √† une vision du code comme [**outil de communication**]{.orange}

- Favoriser la [**lisibilit√©**]{.orange} et la [**maintenabilit√©**]{.orange}

- Faciliter la [**r√©utilisation**]{.orange}

## Principes g√©n√©raux

- Adopter les [**standards communautaires**]{.orange}

- Utiliser des [**fonctions**]{.orange}

- [**(Auto-)documenter**]{.orange} son code

## :one: Standards communautaires

> *"Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread"*
>
> [Tidyverse Style Guide (R)](https://style.tidyverse.org/)

- [**Python**]{.blue2} : [PEP8](https://peps.python.org/pep-0008/), [PEP 257](https://peps.python.org/pep-0257/)
    - Des r√®gles *opinionated*, mais [**conventionnelles**]{.blue2}

- La [**coh√©rence intra-projet**]{.orange} doit toujours primer

## :one: Standards communautaires - Outils {.smaller}

- [**Linters**]{.blue2} : diagnostic de qualit√© du code
    - [Pylint](https://github.com/PyCQA/pylint)

- [**Formatters**]{.blue2} : application automatique des standards
    - [Black](https://github.com/psf/black)

. . .

::: {.callout-tip}
- [Exemples d‚Äôerreurs rep√©r√©es]{.blue2} par un _linter_ :
    + lignes de code trop longues ou mal indent√©es, parenth√®ses non √©quilibr√©es, noms de fonctions mal construits‚Ä¶
- [Exemples d‚Äôerreurs __non__ rep√©r√©es]{.blue2} par un _linter_ :
    + fonctions mal utilis√©es, arguments mal sp√©cifi√©s, structure du code incoh√©rente, code insuffisamment document√©‚Ä¶
:::

## :two: Utiliser des fonctions {.smaller}

::: {.callout-important}
## R√®gle d'or

Il faut utiliser une [**fonction**]{.red2} d√®s qu'on utilise une m√™me
portion de code plus de deux fois ([**_don't repeat yourself_ (DRY)**]{.red2})
:::

- [**Limite les risques d'erreurs**]{.orange} li√©s aux copier/coller
- Rend le code [**plus lisible**]{.orange} et [**plus compact**]{.orange}
- [**Un seul endroit**]{.orange} du code √† modifier lorsqu'on souhaite modifier le traitement
- Facilite la [**r√©utilisation**]{.orange} et la [**documentation**]{.orange} du code !

. . .

::: {.callout-tip}
## R√®gles pour √©crire des fonctions **pertinentes**

- Une t√¢che = une fonction
- Une t√¢che complexe = un encha√Ænement de fonctions r√©alisant chacune une t√¢che simple
- Limiter l'utilisation de variables globales.

:::

## :three: Documenter son code

- Documenter le [__pourquoi__]{.orange} plut√¥t que le [__comment__]{.orange}

- Privil√©gier l'[**auto-documentation**]{.orange} via des nommages pertinents

. . .

::: {.callout-tip}
## Comment bien documenter un script ?

- [**Minimum**]{.orange} üö¶ : d√©crire ce que le code fait au d√©but du script
- [**Bien**]{.orange} üëç : commenter les parties "d√©licates" du code
- [**Id√©al**]{.orange} üí™ : documenter ses fonctions avec des *docstrings*
:::


# :three: Structure des projets

## Enjeux

- Favoriser la [**lisibilit√©**]{.orange} et la [**maintenabilit√©**]{.orange}

- Enjeux sp√©cifiques √† la data science
    - [**Exp√©rimentation**]{.blue2}
    - [**Non-lin√©arit√©**]{.blue2}
    - [**Reproductibilit√©**]{.blue2}

## Principes g√©n√©raux

- Favoriser une [**structure modulaire**]{.blue2} selon l'√©tat du projet
    - [**Exploration**]{.orange} : travail √† partir de [**notebooks**]{.blue2}
    - [**Industrialisation**]{.orange} : adopter une structure type [**package**]{.blue2}

- Adopter les [**standards communautaires**]{.orange}

- [**(Auto-)documenter**]{.orange} son projet

## :one: Phase d'exploration : *notebooks*

- [**Avantages**]{.orange}
  - [**Interactivit√©**]{.blue2} : id√©al pour l'exp√©rimentation
  - [**Communication**]{.blue2} : diffusion de r√©sultats sous forme ex√©cutable

- [**Inconv√©nients**]{.orange}
  - [**Reproductibilit√©**]{.blue2} g√©n√©ralement limit√©e
  - Pas adapt√©s pour l'[**automatisation**]{.blue2}
  - Mal g√©r√©s par le [**contr√¥le de version**]{.blue2}

## :two: Industrialisation : structure modulaire

- [**Premier niveau**]{.orange} : structuration du [**code**]{.orange}

- Adopter une structure type [**package**]{.orange}
  - Des [**fonctions**]{.blue2} rang√©es dans des [**modules**]{.blue2}
  - Un script principal (`main`) [**orchestre**]{.blue2} les traitements
  - Utilisation de [**chemins relatifs**]{.blue2} uniquement

## :two: Industrialisation : structure modulaire

- [**Deuxi√®me niveau**]{.orange} : structuration du [**projet**]{.orange}

. . .

![](img/project-modularity.png){fig-align="center" height=350}

## :three: Adopter les standards communautaires

- [**Templates**]{.orange} de projets : [**Cookiecutters**]{.blue2}
    - [Cookiecutter Data Science](https://drivendata.github.io/cookiecutter-data-science/)
    - [Cookiecutter Python Package](https://py-pkgs.org/03-how-to-package-a-python#creating-a-package-structure)

- La [**coh√©rence intra-projet**]{.orange} doit toujours primer

## :four: Documenter son projet

- Favoriser l'[**auto-documentation**]{.orange} via des nommages pertinents

## L'auto-documentation : illustration

```
‚îú‚îÄ‚îÄ report.ipynb
‚îú‚îÄ‚îÄ correlation.png
‚îú‚îÄ‚îÄ data.csv
‚îú‚îÄ‚îÄ data2.csv
‚îú‚îÄ‚îÄ fig1.png
‚îú‚îÄ‚îÄ figure 2 (copy).png
‚îú‚îÄ‚îÄ report.pdf
‚îú‚îÄ‚îÄ partial data.csv
‚îú‚îÄ‚îÄ script.py
‚îî‚îÄ‚îÄ script_final.py
```

- Difficile de rentrer dans le projet...
    - Tout au [**m√™me niveau**]{.blue2}
    - Titres [**non informatifs**]{.blue2}

## L'auto-documentation : illustration

```
‚îú‚îÄ‚îÄ data
‚îÇ   ‚îú‚îÄ‚îÄ raw
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data.csv
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ data2.csv
‚îÇ   ‚îî‚îÄ‚îÄ interim
‚îÇ       ‚îî‚îÄ‚îÄ partial data.csv
‚îú‚îÄ‚îÄ notebooks
‚îÇ   ‚îî‚îÄ‚îÄ report.ipynb
‚îú‚îÄ‚îÄ src
|   ‚îú‚îÄ‚îÄ script.py
‚îÇ   ‚îî‚îÄ‚îÄ script_final.py
‚îî‚îÄ‚îÄ reports
    ‚îú‚îÄ‚îÄ report.pdf
    ‚îî‚îÄ‚îÄ figures
        ‚îú‚îÄ‚îÄ fig1.png
        ‚îú‚îÄ‚îÄ figure 2 (copy).png
        ‚îú‚îÄ‚îÄ figure10.png
        ‚îî‚îÄ‚îÄ correlation.png
```

- Une structure d√©j√† plus lisible !
    - Les titres restent [**non informatifs**]{.blue2}

## L'auto-documentation : illustration

```
‚îú‚îÄ‚îÄ data
‚îÇ   ‚îú‚îÄ‚îÄ raw
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dpe_logement_202103.csv
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dpe_logement_202003.csv
‚îÇ   ‚îî‚îÄ‚îÄ interim
‚îÇ       ‚îî‚îÄ‚îÄ dpe_logement_merged_preprocessed.csv
‚îú‚îÄ‚îÄ notebooks
‚îÇ   ‚îî‚îÄ‚îÄ report.ipynb
‚îú‚îÄ‚îÄ src
|   ‚îú‚îÄ‚îÄ main.R
|   ‚îú‚îÄ‚îÄ preprocessing.R
‚îÇ   ‚îî‚îÄ‚îÄ generate_plots.R
‚îî‚îÄ‚îÄ reports
    ‚îú‚îÄ‚îÄ report.pdf
    ‚îî‚îÄ‚îÄ figures
        ‚îú‚îÄ‚îÄ histogram_energy_diagnostic.png
        ‚îú‚îÄ‚îÄ barplot_consumption_pcs.png
        ‚îú‚îÄ‚îÄ correlation_matrix.png
        ‚îî‚îÄ‚îÄ correlation.png
```

- Une structure [**auto-document√©e**]{.blue2}
    - On comprend le projet sans m√™me lire le code

## :four: Documenter son projet

- Favoriser l'[**auto-documentation**]{.orange} via des nommages pertinents

- Inclure un fichier `README.md` √† la racine du projet
    - [**Carte d'identit√©**]{.blue2} et [**vitrine**]{.blue2} du projet
    - Pr√©sente le [**contexte**]{.blue2} et le [**fonctionnement**]{.blue2} du projet

- Si [**open-source**]{.orange} : inclure une [licence](https://docs.github.com/fr/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/licensing-a-repository)



# Application

## Bonnes pratiques de d√©veloppement

- Consignes sur le [site du cours](https://ensae-reproductibilite.github.io/website/chapters/application.html)
    - Partie :zero: : initialisation de l'environnement et du projet
    - Partie :one: : qualit√© du code
    - Partie :two: : adoption d'une structure modulaire


# :four: Traitement des donn√©es volumineuses

## "The obligatory intro slide"

![Source : [motherduck.com](https://motherduck.com/blog/big-data-is-dead/)](img/intro-big-data.png){fig-align="center" height=400}

## Enjeux

- Tendance √† la [**massification**]{.orange} des donn√©es

![Source : [AI with Python](https://www.packtpub.com/product/artificial-intelligence-with-python-second-edition/9781839219535)](img/vvv.png){fig-align="center" height=350 .fragment}

## Enjeux

- N√©cessit√© de bien distinguer :
    - [***Storage***]{.blue2} : qu'est-ce que l'on stocke et comment ?
    - [***Compute***]{.blue2} : qu'est-ce que l'on calcule et o√π ?

- Evolutions des [**infrastructures de donn√©es**]{.orange} :
    - [**Bases de donn√©es**]{.blue2} : couplage fort, scalabilit√© verticale
    - [**Infrastructures *big data***]{.blue2} : couplage fort, scalabilit√© horizontale
    - [**Infrastructures *cloud***]{.blue2} : couplage faible, scalabilit√© hybride

## :one: A l'origine : les bases de donn√©es

- Historiquement : stockage dans des [**bases de donn√©es**]{.orange}

- 80's : essor des [bases de donn√©es relationnelles](https://fr.wikipedia.org/wiki/Base_de_donn%C3%A9es_relationnelle)
    - Mod√®le de la [***data warehouse***]{.orange}

![Source : [corporatefinanceinstitute.com](https://corporatefinanceinstitute.com/resources/business-intelligence/data-warehousing/)](img/data-warehouse.png){height="300" fig-align="center" .fragment}

## :one: Limites des *data warehouses*

- Peu adapt√©es aux [**donn√©es *big data***]{.orange} 
    - Limit√©es aux [**donn√©es structur√©es**]{.blue2}
    - N√©cessiter de fixer un [**sch√©ma a priori**]{.blue2}
    - Passage √† l'√©chelle co√ªteux : [**scalabilit√© verticale**]{.blue2}

![Source : [https://dev.to](https://dev.to/yugabyte/horizontal-scaling-vs-vertical-scaling-for-sql-what-s-the-difference-kn2)](img/vertical-scaling-pgsql.png){height="250" fig-align="center" .fragment}

## :two: L'arriv√©e du *data lake* (fin 2000's) {.scrollable}

- Un stockage [**peu co√ªteux**]{.orange} fait pour des [**donn√©es**]{.orange}
  - [**Volumineuses**]{.blue2}
  - [**Brutes**]{.blue2}
  - Sans [**structure d√©finie a priori**]{.blue2}

![Source : [qlik.com](https://www.qlik.com/us/data-lake)](img/datalake.png){height="300" fig-align="center" .fragment}

## :two: Infrastructures *big data* {.scrollable}

- Fin 2000's : une architecture de r√©f√©rence ([Hadoop](https://fr.wikipedia.org/wiki/Hadoop))
    - Une [***data lake***]{.blue2} avec du [**stockage distribu√©**]{.blue2} (HDFS)
    - Des [**frameworks de calcul distribu√©**]{.blue2} ([MapReduce](https://fr.wikipedia.org/wiki/MapReduce), [Spark](https://fr.wikipedia.org/wiki/Apache_Spark))

![Source : [glennklockwood.com](https://www.glennklockwood.com/data-intensive/hadoop/overview.html)](img/mapreduce-hdfs.png){fig-align="center" height="350" .fragment}

## :three: "Big Data is dead" ?

- 2010's : d√©clin de popularit√© des infrastructures Hadoop
    - Limite : [**co-localisation**]{.blue2} du stockage et du calcul

- Jordan Tigani : [Big Data is dead](https://motherduck.com/blog/big-data-is-dead/)
    - Besoins de [***storage***]{.blue2} >> besoins de [***compute***]{.blue2}

![](img/tigani-compute-storage.png){height="330" fig-align="center" .fragment}

## :three: Infrastructures *cloud*

- Fin 2010's : [**les technologies *cloud***]{.orange} permettent l'√©mergence d'architectures [**faiblement coupl√©es**]{.orange}
    - [***Storage***]{.blue2} : [***data lake***]{.blue2} bas√© sur du [**stockage objet**]{.blue2}
    - [***Compute***]{.blue2} : des environnements de traitement √©lastiques aux besoins ([**conteneurs**]{.blue2})

![](img/environment_cloud.png){height="300" fig-align="center" .fragment}

## :three: La fronti√®re du *big data* se d√©cale

- [**Innovations mat√©rielles**]{.orange} (serveurs, CPUs, RAM)

- [**Formats de donn√©es**]{.orange} plus efficients ([**Parquet**]{.orange})

- Des outils de [**traitement *larger-than-memory***]{.orange}

![](img/tigani-big-data-frontier.png){height="330" fig-align="center" .fragment}

## :three: Le format `CSV`

- Le format usuel pour les [**donn√©es tabulaires**]{.orange} est le `CSV`
    - Facilement [**lisible**]{.blue2} 
    - [**Non-compress√©**]{.blue2} : espace disque √©lev√©
    - [**Orient√© ligne**]{.blue2} : mal adapt√© aux traitements analytiques

![](img/columnar-storage.png){height="300" fig-align="center" .fragment}

## :three: Le format `Parquet` : propri√©t√©s

- [**Orient√© colonne**]{.orange}
  - Adapt√© aux [**traitements analytiques**]{.blue2}
  - Con√ßu pour √™tre √©crit une fois mais lu fr√©quemment

- [**Optimis√©**]{.orange}
  - [**Compression**]{.blue2} (jusqu'√† 87 % moins d'espace qu'un CSV)
  - [**Lecture**]{.blue2} du fichier (jusqu'√† 34x plus rapide qu'un CSV)

- [**Interop√©rable**]{.orange}
    - Gestion native des [**m√©ta-donn√©es**]{.blue2}

## :three: `Parquet` : partitionnement

- [**Division en blocs**]{.orange} des donn√©es selon un [**crit√®re**]{.orange}
  - [**Optimise la lecture**]{.blue2} pour certaines requ√™tes

![](img/parquet-partition.png){height="400" fig-align="center" .fragment}

## :three: Traitement *in-memory*

- `Parquet` ne r√©sout pas tout
  - L'espace disque est optimis√©
  - Les donn√©es d√©compress√©es doivent [**passer en RAM**]{.blue2}

- Avec un *framework* traditionnel de [**calcul en m√©moire**]{.orange} (`Pandas`, `dplyr` en `R`, etc.)
    - [**Gain en lecture**]{.blue2} gr√¢ce √† la compression `Parquet`
    - Oblig√© de charger [**l'ensemble du fichier en m√©moire**]{.blue2}
    - [**Perte de l'avantage de la structure en colonne**]{.blue2}

## :three: Traitement *larger-than-memory*

- Calcul [***larger than memory* optimis√©**]{.blue2}
    - [Arrow](https://arrow.apache.org/overview/) : orientation fichier (`Parquet`)
    - [DuckDB](https://duckdb.org/) : orientation base de donn√©es (`SQL`)

- Principes communs : 
    - [**Orientation colonne**]{.blue2} : synergie avec `Parquet`
    - [**Lazy evaluation**]{.blue2} : tr√®s efficient en donn√©es

![](img/parquet-read-columns.png){height="200" fig-align="center" .fragment}

## :three: `DuckDB` : un connecteur interop√©rable entre sources de donn√©es

![](img/duckdb-intero.png){height="500" fig-align="center" .fragment}

## R√©sum√© : pour traiter la volum√©trie

- Choisir une [**infrastructure**]{.orange} adapt√©e aux besoins
    - Les [**technologies *cloud***]{.blue2} offrent un tr√®s bon compromis co√ªt / flexibilit√©

- Utiliser un [**format**]{.orange} de donn√©es adapt√© (`Parquet`)

- Utiliser des [**outils**]{.orange} de traitement adapt√©s
  - Suffisant la plupart du temps : [**calcul *larger than memory* optimis√©**]{.blue2} (`DuckDB`)
  - Si volum√©trie massive : [**calcul distribu√©**]{.blue2} (`Spark`)


# :five: Portabilit√©

## "It works... on my machine" {.scrollable}

- On a construit un projet [**lisible**]{.orange}, [**structur√©**]{.orange} et [**versionn√©**]{.orange}

- Peut-on [**partager**]{.orange} notre projet ?
    - En th√©orie, oui !
    - En pratique, c'est toujours plus compliqu√©...

![Source : [simply-the-test.blogspot.com](https://simply-the-test.blogspot.com/2010/05/it-works-on-my-machine.html)](img/IWOMM.jpg){fig-align="center" height=350 .fragment}

## Pourquoi se pr√©occuper de portabilit√© ?

- Consid√©rons un [***workflow* standard**]{.orange} de *data science*
    - Installer une distribution de `Python` sur son poste
    - D√©velopper un projet en installant les packages n√©cessaires
    - Passer au projet suivant et ainsi de suite

- Quels [**probl√®mes**]{.orange} peuvent se poser ?

## Pourquoi se pr√©occuper de portabilit√© ?

- [**Conflits de version**]{.orange} : diff√©rents projets peuvent requ√©rir des versions diff√©rentes d'un m√™me *package*

- [**Version de `Python` fixe**]{.orange}, celle de l'installation syst√®me

- [**Reproductibilit√© limit√©e**]{.orange} : difficile de dire quel projet n√©cessite quel package

- [**Portabilit√© limit√©e**]{.orange} : difficile de fixer dans un fichier les d√©pendances sp√©cifiques √† un projet

## Le crit√®re de la portabilit√©

- Un code n'est pas auto-suffisant, il contient en g√©n√©ral de nombreuses [**adh√©rences**]{.orange}
    - Un [**langage de programmation**]{.blue2} et sa [**version**]{.blue2}
    - Des [**d√©pendances**]{.blue2}
    - Des [**librairies syst√®me**]{.blue2}

- [**Portabilit√©**]{.orange} : capacit√© d'un code √† s'ex√©cuter dans un environnement diff√©rent que celui de d√©veloppement
    - Enjeu central de la [**mise en production**]{.blue2} !

## Comment favoriser la portabilit√© ?

- Constuire des [**"bulles" plus ou moins isol√©es**]{.orange} autour de son projet afin de [***packager* l'environnement**]{.orange} n√©cessaire

- Des outils d√©di√©s :
    - Les [**environnements virtuels**]{.blue2} : tr√®s simples √† prendre en main, [**portabilit√© moyenne**]{.blue2}
    - Les [**conteneurs**]{.blue2} : plus complexes d'utilisation, [**portabilit√© maximale**]{.blue2}

## Environnements virtuels : fonctionnement {.scrollable}

- [**Dossier "auto-suffisant"**]{.orange} qui :
    - contient un [**intepr√©teur**]{.blue2} `Python` et des [**packages**]{.blue2}
    - est [**isol√©**]{.orange} des autres environnements existants

![Source : [dataquest.io](https://www.dataquest.io/blog/a-complete-guide-to-python-virtual-environments/)](img/venv.png){fig-align="center" height=350 .fragment}

## Environnements virtuels : impl√©mentations

-  [**Impl√©mentation standard**]{.orange} de `Python` : [venv](https://docs.python.org/fr/3/library/venv.html)
    - Il en existe bien d'autres (`virtualenv`, `pipenv`, etc.)

- Tr√®s li√© au [**mode d'installation des *packages***]{.orange}
    - Python "standard" : `venv` + `pip`
    - Limites :
        - Lenteur de la [**r√©solution des d√©pendances**]{.blue2}
        - D√©pendance √† la version syst√®me de `Python`

- [**Une impl√©mentation qui monte**]{.orange} tr√®s (tr√®s) vite : [uv](https://docs.astral.sh/uv/)

## `uv` : un outil pour les gouverner tous

![Source : [alpopkes.com](https://alpopkes.com/posts/python/packaging_tools/?ref=blog.ippon.fr/)](img/uv-venn.png){fig-align="center" height=500 .fragment}

## `uv` : utilisation

- [**Initialiser**]{.orange} un projet : `uv init <nom_du_projet>`
    - G√©n√®re une [**structure de projet**]{.blue2}

- [**Installer**]{.orange} un package : `uv add scikit-learn`
    - G√©n√®re automatiquement un [**environnement virtuel**]{.blue2} (`venv`)

- [**Ex√©cuter**]{.orange} un script : `uv run script.py`
    - Le script est ex√©cut√© avec l'interp√©teur `Python` [**de l'environnement virtuel**]{.blue2}

## Sp√©cifier l'environnement du projet

- D√©velopper dans un [**environnement virtuel**]{.orange} est une bonne pratique

- Favorise la [**reproductibilit√©**]{.orange}
    - A chaque installation d'un *package*, `uv` met √† jour le fichier `uv.lock` qui [**sp√©cifie toutes les d√©pendances**]{.blue2}
    - `uv sync` ->  [**recr√©e l'environnement complet**]{.blue2}

- Favorise la [**portabilit√©**]{.orange}
    - A chaque installation d'un *package*, `uv` maj le fichier `pyproject.yaml` qui [**sp√©cifie les *packages* n√©cessaires**]{.blue2}
    - A *commit* sur `Git` pour [**distribuer la "recette" de l'environnement**]{.blue2}

## Faire √©voluer les versions

- [**Arbitrage**]{.orange} √† trouver entre :
    - [**Reproductibilit√©**]{.blue2} : [**sp√©cifier**]{.blue2} finement les versions
    - [**Fonctionnalit√©s et s√©curit√©**]{.blue2} : faire [**√©voluer**]{.blue2} les versions

## Environnements virtuels : limites

- [**Limit√©s au langage**]{.orange}  de programmation et ses *packages* :
    - Pas de gestion des [**librairies syst√®me**]{.blue2} qui d√©pendent du syst√®me d'exploitation
    - Non adapt√©s √† des [**projets multi-langages**]{.blue2}

- Les environnements virtuels [**facilitent la portabilit√©, mais ne suffisent pas √† la garantir**]{.orange} 

## Le *gold-standard* de la portabilit√©

- Au lieu de distribuer la [**recette**]{.orange} pour recr√©er la bonne machine, peut-on [**distribuer directement la bonne machine**]{.orange} ?
    - Id√©e 1 : distribuer des [**machines physiques**]{.blue2} : complexe...
    - Id√©e 2 : distribuer des [**machines virtuelles**]{.blue2} : possible mais co√ªteux

- Les [**conteneurs**]{.orange} offrent le compromis id√©al
    - [**Isolation compl√®te**]{.blue2} de l'environnement
    - Relativement [**l√©gers**]{.blue2} et donc facilement redistribuables

## Conteneurs vs. machines virtuelles

![Source : [docker.com](https://www.docker.com/resources/what-container/)](img/docker-vm.png)

## Conteneurs : impl√©mentations

- Plusieurs impl√©mentations des conteneurs
    - [**`Docker`**]{.blue2} est largement pr√©dominant

![](img/docker.png){fig-align="center" height=200 .fragment}

## `Docker` : installation

- `Docker` : outil en ligne de commande (CLI)
    - [Instructions](https://docs.docker.com/get-docker/) selon le syst√®me d'exploitation
    - Environnement "bac √† sable" : [Play with Docker](https://labs.play-with-docker.com/)

![](img/playwithdocker.png){fig-align="center" height=350 .fragment}

## Le `Dockerfile`

- Exemple : conteneurisation d'une application interactive [Flask](https://flask.palletsprojects.com/en/stable/)

. . .

```Dockerfile  {.scrollable}
FROM ubuntu:20.04

RUN apt-get update -y && \
    apt-get install -y python3-pip python3-dev

WORKDIR /app

COPY requirements.txt /app/requirements.txt
RUN pip install -r requirements.txt

COPY . /app

ENV FLASK_APP="my-app.py"
EXPOSE 5000

CMD ["flask", "run", "--host=0.0.0.0"]
```

## `Docker` : fonctionnement

![Source : [k21academy.com](https://k21academy.com/docker-kubernetes/docker-and-kubernetes/)](img/docker-workflow.png){fig-align="center"}

## `Docker` en pratique

- Pr√©sentation d√©taill√©e sur la [page du cours](https://ensae-reproductibilite.github.io/website/chapters/portability.html#les-conteneurs)
    - [**Concepts**]{.blue2} (*caching*, *buildtime/runtime*)
    - [**Commandes**]{.blue2} essentielles
    - [**Application**]{.blue2} √† un exemple concret


# Application

## Portabilit√© du projet

- Consignes sur le [site du cours](https://ensae-reproductibilite.github.io/website/chapters/application.html)
    - Partie :three: : construction d‚Äôun projet [**portable**]{.orange} et [**reproductible**]{.orange}
        - Construire un [**environnement virtuel**]{.blue2} pour le projet
        - [**Conteneuriser**]{.blue2} l'application avec `Docker`


# Partie :two: : mise en production

## Le "mur de la production"

- La majorit√© des projets "*data-driven*" [**ne d√©livrent pas de valeur**]{.blue2} ([1](https://sloanreview.mit.edu/projects/expanding-ais-impact-with-organizational-learning/), [2](https://hdsr.mitpress.mit.edu/pub/2fu65ujf/release/6), [3](https://www.researchgate.net/publication/346647451_Beyond_the_Hype_Why_Do_Data-Driven_Projects_Fail))

- Comment [**d√©passer le stade de l'exp√©rimentation**]{.orange} ?

## Mise en production

- [**Mettre en production**]{.orange} : faire [**vivre**]{.blue2} une application dans l'espace de ses [**utilisateurs**]{.blue2}
    - [**Servir**]{.orange} : [**d√©ployer**]{.blue2} l'application dans un [**format pertinent**]{.blue2} aupr√®s de ses utilisateurs potentiels
    - [**Faire vivre**]{.orange} : g√©rer le [**cycle de vie**]{.blue2} et favoriser l'[**am√©lioration continue**]{.blue2}

- [**Multiples dimensions**]{.orange} : connaissance m√©tier, organisation, infrastructure, outils techniques..

## Favoriser la continuit√©

![Source : [ibm.com](https://public.dhe.ibm.com/software/data/sw-library/analytics/data-science-lifecycle/#model-implementation)](img/exploration-production.png){fig-align="center"}

- [**Comment faire ?**]{.orange}
    - Application des [**bonnes pratiques**]{.blue2} de d√©veloppement
    - Besoin de [**nouveaux concepts et outils**]{.blue2} : [DataOps](https://dataopsmanifesto.org/fr/)

## Le DataOps

- Origine : mouvement [DevOps](https://fr.wikipedia.org/wiki/Devops)

. . .

![Source : [syloe.com](https://www.syloe.com/expert-devops-automatisation-deploiements/)](img/devops.png){fig-align="center" height=300}

- [**DataOps**]{.orange} : construction de [**pipelines de donn√©es**]{.blue2}

- [**MLOps**]{.orange} : d√©ploiement et maintenance de [**mod√®les de ML**]{.blue2}

## Plan de la partie

:six: Introduction au format [**YAML**]{.blue2}

:seven: [**D√©ploiement**]{.blue2}

:eight: [**MLOps**]{.blue2}


{{< include sections/yaml101.qmd >}} -->
</section>
<section>
<section id="d√©ploiement" class="title-slide slide level1 center">
<h1><span class="emoji" data-emoji="seven">7Ô∏è‚É£</span> D√©ploiement</h1>

</section>
<section id="la-mise-en-production" class="slide level2">
<h2>La mise en production</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Mettre en production</strong></span> : faire <span class="blue2"><strong>vivre</strong></span> une application dans l‚Äôespace de ses <span class="blue2"><strong>utilisateurs</strong></span>
<ul>
<li class="fragment"><span class="orange"><strong>Service</strong></span> : <span class="blue2"><strong>d√©ployer</strong></span> l‚Äôapplication dans un <span class="blue2"><strong>format</strong></span> qui r√©pond aux <span class="blue2"><strong>besoins</strong></span> des utilisateurs potentiels</li>
<li class="fragment"><span class="orange"><strong>Faire vivre</strong></span> :
<ul>
<li class="fragment"><span class="blue2"><strong>Superviser</strong></span> l‚Äôapplication pour la rendre performante</li>
<li class="fragment">Favoriser l‚Äô<span class="blue2"><strong>am√©lioration continue</strong></span></li>
</ul></li>
</ul></li>
<li class="fragment">L‚Äôobjectif de ce chapitre est de convertir un <span class="orange"><strong>projet maintenable et portable</strong></span> en un <span class="orange"><strong>service exploitable</strong></span></li>
</ul>
</section>
<section id="un-sujet-large" class="slide level2">
<h2>Un sujet large</h2>
<ul>
<li class="fragment">Les <span class="orange"><strong>questions essentielles</strong></span> √† se poser :
<ul>
<li class="fragment">Quel <span class="blue2"><strong>format adapt√©</strong></span> pour r√©pondre aux <span class="blue2"><strong>besoins</strong></span> ?</li>
<li class="fragment">Quelle <span class="blue2"><strong>infrastructure de production</strong></span> pour assurer la <span class="blue2"><strong>performance</strong></span> et le <span class="blue2"><strong>passage √† l‚Äô√©chelle</strong></span> ?</li>
<li class="fragment">Comment <span class="blue2"><strong>superviser</strong></span> l‚Äôapplication pour assurer sa <span class="blue2"><strong>r√©silience</strong></span> en production ?</li>
<li class="fragment">Comment <span class="blue2"><strong>automatiser</strong></span> le processus de d√©ploiement pour permettre l‚Äô<span class="blue2"><strong>am√©lioration continue</strong></span> ?</li>
</ul></li>
<li class="fragment">De nombreuses <span class="orange"><strong>solutions techniques</strong></span> possibles
<ul>
<li class="fragment">Pr√©sentation des <span class="blue2"><strong>concepts standards</strong></span></li>
</ul></li>
</ul>
</section>
<section id="formats-de-valorisation" class="slide level2">
<h2>Formats de valorisation</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Crit√®res</strong></span> √† prendre en compte :
<ul>
<li class="fragment">Quels sont les <span class="blue2"><strong>utilisateurs</strong></span> potentiels ?</li>
<li class="fragment">Quels sont leurs <span class="blue2"><strong>besoins</strong></span> ?</li>
</ul></li>
<li class="fragment">Exemple ‚Äúfil rouge‚Äù : comment <span class="orange"><strong>servir un projet de ML</strong></span> √† ses utilisateurs potentiels ?</li>
</ul>
</section>
<section id="servir-un-projet-de-ml" class="slide level2">
<h2>Servir un projet de ML</h2>
<ul>
<li class="fragment">Mettre √† disposition le <span class="orange"><strong>code</strong></span> pour entra√Æner le mod√®le
<ul>
<li class="fragment"><span class="blue2"><strong>Reproductible</strong></span>‚Ä¶ si on a les <span class="blue2"><strong>donn√©es</strong></span> et les <span class="blue2"><strong>ressources</strong></span></li>
</ul></li>
<li class="fragment">Mettre √† disposition le <span class="orange"><strong>mod√®le entra√Æn√©</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Audience technique</strong></span> et <span class="blue2"><strong>adh√©rence</strong></span> au <em>framework</em> d‚Äôentra√Ænement du mod√®le</li>
</ul></li>
<li class="fragment">Exposer le mod√®le via une <span class="orange"><strong>API</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Audience technique</strong></span> mais plus large car <span class="blue2"><strong>interop√©rable</strong></span></li>
</ul></li>
<li class="fragment">Exposer le mod√®le via une <span class="orange"><strong>interface interactive</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Audience large</strong></span> mais plus <span class="blue2"><strong>co√ªteux</strong></span></li>
</ul></li>
</ul>
</section>
<section id="servir-un-mod√®le-de-ml-via-une-api" class="slide level2">
<h2>Servir un mod√®le de ML via une API</h2>
<ul>
<li class="fragment">Construire une <span class="orange"><strong>API</strong></span> pour <span class="orange"><strong>servir</strong></span> le mod√®le
<ul>
<li class="fragment"><span class="blue2"><strong>Interface</strong></span> entre <span class="blue2"><strong>l‚Äôutilisateur</strong></span> et le <span class="blue2"><strong>mod√®le</strong></span> entra√Æn√©</li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/api-serve-ml-model.png" height="350"></p>
<figcaption>Source : <a href="https://machinelearningmastery.com/a-practical-guide-to-deploying-machine-learning-models/">https://machinelearningmastery.com</a></figcaption>
</figure>
</div>
</div>
</section>
<section id="les-apis-d√©finition-formelle" class="slide level2">
<h2>Les APIs : d√©finition formelle</h2>
<blockquote>
<p>Une API (<em>application programming interface</em>) est une <strong>interface logicielle</strong> qui permet de ¬´ connecter ¬ª un logiciel ou un service √† un autre logiciel ou service afin d‚Äô√©changer des donn√©es et des fonctionnalit√©s.</p>
<p><a href="https://www.cnil.fr/fr/definition/interface-de-programmation-dapplication-api">CNIL</a></p>
</blockquote>
<ul>
<li class="fragment">D√©finition peu informative : avec cette d√©finition tout est plus ou moins une API‚Ä¶</li>
</ul>
</section>
<section id="les-apis-d√©finition-op√©rationnelle" class="slide level2">
<h2>Les APIs : d√©finition op√©rationnelle</h2>
<ul>
<li class="fragment">Une <span class="orange"><strong>API</strong></span> est un <span class="orange"><strong>contrat logiciel</strong></span> qui d√©finit :
<ul>
<li class="fragment">Ce que l‚Äôon peut <span class="blue2"><strong>demander</strong></span></li>
<li class="fragment">Sous quel <span class="blue2"><strong>format</strong></span></li>
<li class="fragment">Ce que l‚Äôon <span class="blue2"><strong>re√ßoit en retour</strong></span></li>
</ul></li>
<li class="fragment">Une <span class="orange"><strong>API</strong></span> permet √† deux syst√®mes de communiquer <span class="orange"><strong>sans exposer leur impl√©mentation interne</strong></span></li>
</ul>
</section>
<section id="les-apis-rest" class="slide level2">
<h2>Les APIs REST</h2>
<ul>
<li class="fragment"><span class="orange"><strong>API RESTful</strong></span> : API conforme au style d‚Äôarchitecture <a href="https://fr.wikipedia.org/wiki/Representational_state_transfer">REST</a>
<ul>
<li class="fragment">Repose sur le <span class="blue2"><strong>protocole HTTP</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/api-rest.png" height="400"></p>
<figcaption>Source : <a href="https://www.apisec.ai/blog/rest-api-and-its-significance-to-web-service-providers">apisec.ai</a></figcaption>
</figure>
</div>
</div>
</section>
<section id="exemples-dapi-rest" class="slide level2">
<h2>Exemples d‚ÄôAPI REST</h2>
<ul>
<li class="fragment"><span class="blue2"><strong>Le client</strong></span> :
<ul>
<li class="fragment">envoie des <span class="blue2"><strong>requ√™tes HTTP</strong></span> (<code>GET</code>, <code>POST</code>, etc.)</li>
<li class="fragment">√† un <span class="blue2"><strong>serveur</strong></span> accessible depuis une <span class="blue2"><strong>URL</strong></span></li>
<li class="fragment">sur un certain <span class="blue2"><strong>endpoint</strong></span> qui expose le <span class="blue2"><strong>service</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<p>Exemple : <a href="https://api-adresse.data.gouv.fr/search/?q=com√©die&amp;type=street">https://api-adresse.data.gouv.fr/search/?q=com√©die&amp;type=street</a></p>
<ul>
<li class="fragment">Le <span class="blue2"><strong>serveur</strong></span> renvoie une <span class="blue2"><strong>r√©ponse</strong></span> : un <a href="https://restfulapi.net/http-status-codes/">code retour</a> et de la donn√©e (en l‚Äôabsence d‚Äôerreur), souvent au format <code>JSON</code></li>
</ul>
</div>
</section>
<section id="architecture-cible" class="slide level2">
<h2>Architecture cible</h2>
<ul>
<li class="fragment">Construire une <span class="orange"><strong>API</strong></span> pour <span class="orange"><strong>servir</strong></span> le mod√®le
<ul>
<li class="fragment"><span class="blue2"><strong>Interface</strong></span> entre <span class="blue2"><strong>l‚Äôutilisateur</strong></span> et le <span class="blue2"><strong>mod√®le</strong></span> entra√Æn√©</li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/api-no-mlflow.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
</div>
</section>
<section id="de-lapi-locale-au-service-d√©ploy√©" class="slide level2">
<h2>De l‚ÄôAPI locale au service d√©ploy√©</h2>
<ul>
<li class="fragment">On a les outils pour <span class="orange"><strong>construire une API locale</strong></span>
<ul>
<li class="fragment">Du <span class="blue2"><strong>code applicatif</strong></span> auquel il faut rajouter une <span class="blue2"><strong>API</strong></span></li>
<li class="fragment">Une <span class="blue2"><strong>couche de stockage</strong></span> pour le mod√®le entra√Æn√©</li>
<li class="fragment">La <span class="blue2"><strong>conteneurisation</strong></span> pour encapsuler l‚Äôapplication</li>
</ul></li>
<li class="fragment">Il nous manque des outils pour en faire un <span class="orange"><strong>service d√©ploy√© et r√©silient</strong></span>
<ul>
<li class="fragment">Un <span class="blue2"><strong>environnement de production</strong></span> pour le d√©ploiement</li>
<li class="fragment">Des <span class="blue2"><strong>outils de supervision</strong></span> pour g√©rer la charge</li>
<li class="fragment">Des <span class="blue2"><strong>outils d‚Äôautomatisation</strong></span> pour l‚Äôam√©lioration en continu de l‚Äôapplication</li>
</ul></li>
</ul>
</section>
<section id="environnement-de-production" class="slide level2">
<h2>Environnement de production</h2>
<ul>
<li class="fragment"><p>D√©pend essentiellement de l‚Äôinfrastructure √† disposition</p></li>
<li class="fragment"><p><span class="orange"><strong>Propri√©t√©s recherch√©es</strong></span> :</p>
<ul>
<li class="fragment">Adapter les ressources (<span class="blue2"><strong>scaler</strong></span>) selon les besoins</li>
<li class="fragment">D√©ploiements <span class="blue2"><strong>reproductibles</strong></span> et <span class="blue2"><strong>automatis√©s</strong></span></li>
<li class="fragment"><span class="blue2"><strong>Monitoring</strong></span> de l‚Äô√©tat de sant√© des applications</li>
</ul></li>
<li class="fragment"><p>Solution : utiliser un <span class="orange"><strong>orchestrateur de conteneurs</strong></span></p>
<ul>
<li class="fragment">Base du <code>SSP Cloud</code> : <a href="https://kubernetes.io/fr/">Kubernetes</a></li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/kubernetes-logo.png" class="fragment quarto-figure quarto-figure-center" height="100"></p>
</figure>
</div>
</section>
<section id="fonctionnement-de-kubernetes" class="slide level2">
<h2>Fonctionnement de Kubernetes</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Approche <em>Infrastructure As Code</em></strong></span> : on d√©clare l‚Äô<span class="blue2"><strong>√©tat d√©sir√© du d√©ploiement</strong></span>, <code>Kubernetes</code> s‚Äôassure en continu qu‚Äôil correspond √† l‚Äô<span class="blue2"><strong>√©tat r√©el</strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/kubernetes-archi.png" height="400"></p>
<figcaption>Source : <a href="https://drsalbertspijkers.blogspot.com/2017/06/red-hat-openshift-and-orchestrating.html">DBA Consulting Blog</a></figcaption>
</figure>
</div>
</div>
</section>
<section id="lapproche-cicd" class="slide level2">
<h2>L‚Äôapproche CI/CD</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Int√©gration continue</strong></span> (CI) : chaque commit d√©clenche un processus ‚Äú<span class="blue2"><strong>test, build and release</strong></span>‚Äù
<ul>
<li class="fragment"><code>GitHub</code> <i class="fa-brands fa-github" aria-label="github"></i> : <a href="https://github.com/features/actions">GitHub Actions</a></li>
<li class="fragment"><code>GitLab</code> <i class="fa-brands fa-gitlab" aria-label="gitlab"></i> : <a href="https://docs.gitlab.com/ee/ci/">GitLab CI/CD</a></li>
</ul></li>
<li class="fragment"><span class="orange"><strong>D√©ploiement continu</strong></span> (CD) : les nouvelles <span class="blue2"><strong>releases</strong></span> sont automatiquement d√©ploy√©es
<ul>
<li class="fragment">Sur le <code>SSP Cloud</code> : <a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD</a></li>
</ul></li>
</ul>
</section>
<section id="ci-impl√©mentation" class="slide level2">
<h2>CI : impl√©mentation</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Principe</strong></span> : commit -&gt; ex√©cution d‚Äôune s√©rie d‚Äô√©tapes
<ul>
<li class="fragment">Script ex√©cut√© sur une VM : <span class="blue2"><strong><em>runner</em></strong></span></li>
<li class="fragment">Mise √† disposition d‚Äôun <em>output</em> : <span class="blue2"><strong><em>artifact</em></strong></span></li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Multiples outputs possibles</strong></span>
<ul>
<li class="fragment"><a href="https://github.com/ensae-reproductibilite/application-correction/blob/appli19b/.github/workflows/prod.yml">Image Docker</a></li>
<li class="fragment"><a href="https://github.com/ensae-reproductibilite/slides/blob/main/.github/workflows/publish.yaml">Slides</a></li>
<li class="fragment"><a href="https://github.com/ensae-reproductibilite/website/blob/main/.github/workflows/publish.yaml">Site internet</a></li>
</ul></li>
</ul>
</section>
<section id="ci-anatomie-dun-fichier-de-ci" class="slide level2 scrollable">
<h2>CI : anatomie d‚Äôun fichier de CI</h2>
<ul>
<li class="fragment">Sp√©cification : fichier <code>.yaml</code> qui param√©trise le <em>runner</em>
<ul>
<li class="fragment">‚ö†Ô∏è Situ√© dans le dossier <code>.github/workflows/</code></li>
</ul></li>
</ul>
<div class="fragment">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/ci.yaml</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-filename=".github/workflows/ci.yaml"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build Docker image</span></span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb1-4"><a></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb1-5"><a></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb1-6"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb1-7"><a></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span></span>
<span id="cb1-8"><a></a></span>
<span id="cb1-9"><a></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb1-10"><a></a><span class="at">  </span><span class="fu">docker</span><span class="kw">:</span></span>
<span id="cb1-11"><a></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb1-12"><a></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-13"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up QEMU</span></span>
<span id="cb1-14"><a></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-qemu-action@v3</span></span>
<span id="cb1-15"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb1-16"><a></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb1-17"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker meta</span></span>
<span id="cb1-18"><a></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb1-19"><a></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/metadata-action@v5</span></span>
<span id="cb1-20"><a></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-21"><a></a><span class="at">          </span><span class="fu">images</span><span class="kw">:</span><span class="at"> ensae-reproductibilite/api-titanic</span></span>
<span id="cb1-22"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Login to Docker Hub</span></span>
<span id="cb1-23"><a></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb1-24"><a></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-25"><a></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ secrets.DOCKERHUB_USERNAME }}</span></span>
<span id="cb1-26"><a></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.DOCKERHUB_TOKEN }}</span></span>
<span id="cb1-27"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and push</span></span>
<span id="cb1-28"><a></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v5</span></span>
<span id="cb1-29"><a></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-30"><a></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-31"><a></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb1-32"><a></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
<section id="cicd-impl√©mentation-sur-kubernetes" class="slide level2">
<h2>CI/CD : impl√©mentation sur <code>Kubernetes</code></h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/ci-cd.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
</section>
<section id="conclusion" class="slide level2">
<h2>Conclusion</h2>
<ul>
<li class="fragment">On a construit un pipeline <span class="orange"><strong>reproductible</strong></span> et <span class="orange"><strong>automatis√©</strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/exploration-production.png" height="250"></p>
<figcaption>Source : <a href="https://public.dhe.ibm.com/software/data/sw-library/analytics/data-science-lifecycle/#model-implementation">ibm.com</a></figcaption>
</figure>
</div>
</div>
<ul>
<li class="fragment">Comment tenir compte des <span class="orange"><strong>sp√©cificit√©s du ML</strong></span> ?
<ul>
<li class="fragment"><span class="blue2"><strong>Approche MLOps</strong></span></li>
</ul></li>
</ul>
</section></section>
<section>
<section id="application" class="title-slide slide level1 center">
<h1>Application</h1>

</section>
<section id="mise-en-production" class="slide level2">
<h2>Mise en production</h2>
<ul>
<li class="fragment">Consignes sur le <a href="https://ensae-reproductibilite.github.io/website/chapters/application.html">site du cours</a>
<ul>
<li class="fragment">Partie <span class="emoji" data-emoji="four">4Ô∏è‚É£</span> : <span class="blue2"><strong>automatisation</strong></span> de la livraison d‚Äôune application avec l‚Äô<span class="blue2"><strong>int√©gration continue</strong></span></li>
<li class="fragment">Partie <span class="emoji" data-emoji="five">5Ô∏è‚É£</span> : <span class="blue2"><strong>d√©ploiement</strong></span> d‚Äôune application et <span class="blue2"><strong>industrialisation</strong></span></li>
</ul></li>
</ul>
<!-- {{< include sections/mlops.qmd >}} -->


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Bonnes pratiques pour la mise en production des projets de data science (<a href="https://ensae-reproductibilite.github.io/">retour <em>homepage</em></a>) <a href="https://github.com/ensae-reproductibilite/"><i class="fa-brands fa-github" aria-label="github"></i></a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copi√©");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copi√©");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/ensae-reproductibilite\.github\.io\/slides\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>