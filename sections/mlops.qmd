# :eight: MLOps

## Motivation

- Intégrer :
    - les [**principes DataOps**]{.orange}
    - les [**spécificités**]{.orange} des projets de ML

. . .

![Source : [ml4devs.com](https://www.ml4devs.com/articles/mlops-machine-learning-life-cycle/)](img/mlops.png){fig-align="center" height=400}

## MLOps : principes

- [**Reproductibilité**]{.orange}

- [**Contrôle de version**]{.orange}

- [**Automatisation**]{.orange}

- [**Collaboration**]{.orange}

- [**Monitoring**]{.orange}

## MLOps : implémentation

- De nombreux [**frameworks**]{.orange} implémentent les principes du MLOps
    - Catalogue du `SSP Cloud` : [MLFlow](https://mlflow.org/)

- Avantages de `MLflow` :
  - [**Open-source**]{.blue2}
  - Couvre l'entièreté du [**cycle de vie**]{.blue2} d'un modèle ML
  - [**Agnostique**]{.blue2} au package ML utilisé
  - Intégration avec `Kubernetes`

## `MLFlow` : vue d'ensemble

![Source : [dzlab.github.io](https://dzlab.github.io/ml/2020/07/12/ml-ci-mlflow/)](img/mlflow-overview.png){fig-align="center" height=350}

## `MLFlow` : Tracking server

- "Une [**API**]{.orange} et une [**interface utilisateur**]{.orange} pour [**enregistrer**]{.orange} les paramètres, les versions du code, les métriques et les artefacts"

. . .

![Source : [Databricks](https://docs.databricks.com/en/mlflow/index.html)](img/mlflow-tracking.png){fig-align="center" height=400}

## `MLFlow` : Models

- "Une convention pour [**'packager'**]{.orange} des [**modèles**]{.orange} de *machine learning* sous plusieurs [**formes**]{.orange}"

. . .

![Source : [Dataiku](https://blog.dataiku.com/introducing-mlflow-saved-models)](img/mlflow-models.png){fig-align="center" height=400}

## `MLFlow` : Model registry

- "Un [**entrepôt centralisé de modèles**]{.orange}, un ensemble d'API et une interface utilisateur pour gérer [**collaborativement**]{.orange}  le cycle de vie complet d'un modèle MLflow"

. . .

![Source : [Databricks](https://www.databricks.com/blog/2019/10/17/introducing-the-mlflow-model-registry.html)](img/mlflow-model-registry.png){fig-align="center" height=400}

## Servir le modèle (sans `MLFlow`)

![](img/api-no-mlflow.png){fig-align="center"}

## Servir le modèle (avec `MLFlow`)

![](img/api-with-mlflow.png){fig-align="center"}

## Suivi du modèle

- Pourquoi [**surveiller**]{.orange} un modèle en production ?
    - Détecter d'éventuels [**biais**]{.blue2} des données d'entraînement
    - Détecter une [**instabilité**]{.blue2} du modèle
    - [**Amélioration continue**]{.blue2} du modèle

- ⚠️ Le mot [**surveillance**]{.orange} d'une application/modèle recouvre des [**réalités différentes**]{.blue2}

## Surveillance selon l'informaticien

- Surveiller une application est partie intégrante de l'approche [**DevOps**]{.orange}

- Contrôle [**technique**]{.orange} de l'API :
    - Latence
    - Mémoire
    - Utilisation disque
    - ...

## Surveillance selon le data scientist

- Surveiller un modèle ML est partie intégrante de l'approche [**MLOps**]{.orange}

- Contrôle [**méthodologique**]{.orange} du modèle

- Performance en [**temps réel**]{.orange} du modèle souvent impossible, utilisation de proxys :
    - [**Data drift**]{.blue2} : la distribution des données d'entrée change dans le temps
    - [**Concept drift**]{.blue2} : la relation modélisée change dans le temps

## Comment surveiller un modèle en production ?

- Intégration de [**logs**]{.orange} dans l'API

- Récupération et mise en forme des logs

- Suivi de [**métriques**]{.orange} de ML

- Mise en place d'un système d'[**alertes**]{.orange}

## Résultat : un pipeline reproductible

![Source: [martinfowler.com](martinfowler.com)](img/ML-model-lifecycle.png){fig-align="center"}


# Application

## MLOps

- Consignes sur le [site du cours](https://ensae-reproductibilite.github.io/website/chapters/application.html)
    - Partie :six: : application des [**principes MLOps**]{.blue2} avec `MLFlow`
